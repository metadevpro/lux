<div class="lux-geolocation" [id]="inputId">
  <input
    #latitude
    class="prefix"
    type="number"
    [id]="inputId + '$latitude'"
    [attr.value]="latitudeValue"
    [attr.aria-label]="ariaLabel"
    [attr.disabled]="disabled === true ? 'true' : undefined"
    [attr.readonly]="readonly === true ? 'true' : undefined"
    [attr.min]="minLatitude !== undefined && minLatitude !== null ? minLatitude.toString() : undefined"
    [attr.max]="maxLatitude !== undefined && maxLatitude !== null ? maxLatitude.toString() : undefined"
    [attr.step]="step !== undefined && step !== null ? step.toString() : undefined"
    placeholder="lat"
    [ngClass]="className"
    (focus)="markAsTouched()"
    (keyup)="onKeyUpLatitude(latitude.value)"
    (change)="onChangeLatitude(latitude.value)"
    (keypress)="onKeyPress($event)"
  />
  <div class="infix symbol">
    <span *ngIf="validNumber(latitudeValue) && latitudeValue >= 0" >N</span>
	  <span *ngIf="validNumber(latitudeValue) && latitudeValue < 0" >S</span>
    <span *ngIf="!validNumber(latitudeValue)">?</span>
  </div>
  <input
    #longitude
    class="infix"
    type="number"
    [id]="inputId + '$longitude'"
    [attr.value]="longitudeValue"
    [attr.aria-label]="ariaLabel"
    [attr.disabled]="disabled === true ? 'true' : undefined"
    [attr.readonly]="readonly === true ? 'true' : undefined"
    [attr.min]="minLongitude !== undefined && minLongitude !== null ? minLongitude.toString() : undefined"
    [attr.max]="maxLongitude !== undefined && maxLongitude !== null ? maxLongitude.toString() : undefined"
    [attr.step]="step !== undefined && step !== null ? step.toString() : undefined"
    placeholder="lon"
    [ngClass]="className"
    (focus)="markAsTouched()"
    (keyup)="onKeyUpLongitude(longitude.value)"
    (change)="onChangeLongitude(longitude.value)"
    (keypress)="onKeyPress($event)"
  />
  <div class="infix symbol">
    <span *ngIf="validNumber(longitudeValue) && longitudeValue >= 0" >E</span>
	  <span *ngIf="validNumber(longitudeValue) && longitudeValue < 0" >W</span>
    <span *ngIf="!validNumber(longitudeValue)">?</span>
  </div>
  <button class="infix" (click)="openModalSearch(modalSearch)">
    <span>üîé</span>
  </button>
  <button class="postfix" (click)="openModalMap(modalMap)">
    <span>üåê</span>
  </button>
</div>

<div *ngIf="inlineErrors && lastErrors && (dirty || touched)" class="alert">
  <div *ngIf="lastErrors.required">
    {{ userErrors[this.lang].required }}
  </div>
  <div *ngIf="lastErrors.minLatitude">
    {{ userErrors[this.lang].minLatitude.replace('$minLatitude', lastErrors.minLatitude.min) }}
  </div>
  <div *ngIf="lastErrors.maxLatitude">
    {{ userErrors[this.lang].maxLatitude.replace('$maxLatitude', lastErrors.maxLatitude.max) }}
  </div>
  <div *ngIf="lastErrors.minLongitude">
    {{ userErrors[this.lang].minLongitude.replace('$minLongitude', lastErrors.minLongitude.min) }}
  </div>
  <div *ngIf="lastErrors.maxLongitude">
    {{ userErrors[this.lang].maxLongitude.replace('$maxLongitude', lastErrors.maxLongitude.max) }}
  </div>
</div>

<ng-template #modalSearch let-modal>
  <div class="lux-modal-header">
    <h4 class="modal-title" id="modal-basic-title">Search</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">√ó</span>
    </button>
  </div>
  <div class="lux-modal-body">
    <input
      #query
      type="text"
      placeholder="Enter query here"
      (change)="searchLocation(query.value)"
    />
    <div class="search-results">
      <ol>
        <li *ngFor="let result of searchResults">
          {{ result.display_name }}
          <button
            type="button"
            class="btn btn-select btn-outline-dark"
            (click)="modal.close([result.lon, result.lat])"
          >
          Select
          </button>
        </li>
      </ol>
    </div>
  </div>
  <div class="lux-modal-footer">
    <button
      type="button"
      class="btn btn-cancel btn-outline-dark"
      (click)="modal.close('cancel')"
    >
    Cancel
    </button>
  </div>
</ng-template>

<ng-template #modalMap let-modal>
  <div class="lux-modal-header">
    <h4 class="modal-title" id="modal-basic-title">Map</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">√ó</span>
    </button>
  </div>
  <div class="lux-modal-body">
    <lux-map #map [center]="value" [currentMarkerGeopoint]="value" [zoom]="zoom"></lux-map>
  </div>
  <div class="lux-modal-footer">
    <button
      type="button"
      class="btn btn-cancel btn-outline-dark"
      (click)="modal.close('cancel')"
    >
    Cancel
    </button>
    <button
      type="button"
      class="btn btn-select btn-outline-dark"
      (click)="modal.close(map.getCoordinatesOfCurrentMarker())"
    >
    Select
    </button>
  </div>
</ng-template>
